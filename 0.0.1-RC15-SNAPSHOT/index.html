
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://sparkutils.github.io/kogito-4-spark/0.0.1-RC15-SNAPSHOT/" rel="canonical"/>
<link href="getting_started/running_on_databricks/" rel="next"/>
<link href="assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.2" name="generator"/>
<title>kogito-4-spark</title>
<link href="assets/stylesheets/main.7bf56d0a.min.css" rel="stylesheet"/>
<link href="assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="stylesheets/site.css" rel="stylesheet"/>
<script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#kogito-4-spark-001-rc15-snapshot">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="kogito-4-spark" class="md-header__button md-logo" data-md-component="logo" href="." title="kogito-4-spark">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            kogito-4-spark
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Home
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/sparkutils/kogito-4-spark/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    kogito-4-spark
  </div>
</a>
</div>
<a class="md-header__button md-header-nav__button md-icon" href="pdf/document.pdf" title="PDF">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
<path d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z" fill="#E2E5E7"></path>
<path d="m384 128h96l-128-128v96c0 17.6 14.4 32 32 32z" fill="#B0B7BD"></path>
<polygon fill="#CAD1D8" points="480 224 384 128 480 128"></polygon>
<path d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16  V416z" fill="#F15642"></path>
<g fill="#fff">
<path d="m101.74 303.15c0-4.224 3.328-8.832 8.688-8.832h29.552c16.64 0 31.616 11.136 31.616 32.48 0 20.224-14.976 31.488-31.616 31.488h-21.36v16.896c0 5.632-3.584 8.816-8.192 8.816-4.224 0-8.688-3.184-8.688-8.816v-72.032zm16.88 7.28v31.872h21.36c8.576 0 15.36-7.568 15.36-15.504 0-8.944-6.784-16.368-15.36-16.368h-21.36z"></path>
<path d="m196.66 384c-4.224 0-8.832-2.304-8.832-7.92v-72.672c0-4.592 4.608-7.936 8.832-7.936h29.296c58.464 0 57.184 88.528 1.152 88.528h-30.448zm8.064-72.912v57.312h21.232c34.544 0 36.08-57.312 0-57.312h-21.232z"></path>
<path d="m303.87 312.11v20.336h32.624c4.608 0 9.216 4.608 9.216 9.072 0 4.224-4.608 7.68-9.216 7.68h-32.624v26.864c0 4.48-3.184 7.92-7.664 7.92-5.632 0-9.072-3.44-9.072-7.92v-72.672c0-4.592 3.456-7.936 9.072-7.936h44.912c5.632 0 8.96 3.344 8.96 7.936 0 4.096-3.328 8.704-8.96 8.704h-37.248v0.016z"></path>
</g>
<path d="m400 432h-304v16h304c8.8 0 16-7.2 16-16v-16c0 8.8-7.2 16-16 16z" fill="#CAD1D8"></path>
</svg>
</a></nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href=".">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="getting_started/running_on_databricks/">
        Getting Started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="site/">
      Maven Site
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="site/scaladocs/com/sparkutils/quality/index.html">
      Scala Docs
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="kogito-4-spark" class="md-nav__button md-logo" data-md-component="logo" href="." title="kogito-4-spark">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    kogito-4-spark
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/sparkutils/kogito-4-spark/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    kogito-4-spark
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href=".">
        Home
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-runtimes">
    Supported Runtimes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-use">
    How to Use
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-dmncontextproviders">
    Supported DMNContextProviders
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-dmnresultproviders">
    Supported DMNResultProviders
  </a>
<nav aria-label="Supported DMNResultProviders" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#result-processing">
    Result Processing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug-mode">
    Debug mode
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="getting_started/running_on_databricks/">
        Running kogito-4-spark on Databricks
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="site/">
        Maven Site
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="site/scaladocs/com/sparkutils/quality/index.html">
        Scala Docs
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-runtimes">
    Supported Runtimes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-use">
    How to Use
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-dmncontextproviders">
    Supported DMNContextProviders
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-dmnresultproviders">
    Supported DMNResultProviders
  </a>
<nav aria-label="Supported DMNResultProviders" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#result-processing">
    Result Processing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug-mode">
    Debug mode
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="kogito-4-spark-001-rc15-snapshot">kogito-4-spark - 0.0.1-RC15-SNAPSHOT<a class="headerlink" href="#kogito-4-spark-001-rc15-snapshot" title="Permanent link">¶</a></h1>
<details class="coverage"><summary>Coverage</summary><p><table>
<tr>
<td>Statement</td>
<td class="coveragePercent">74.24<span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m18.5 3.5 2 2-15 15-2-2 15-15M7 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m10 10c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3M7 6c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1m10 10c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1Z"></path></svg></span></td>
<td>Branch</td>
<td class="coveragePercent">48.93<span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m18.5 3.5 2 2-15 15-2-2 15-15M7 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m10 10c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3M7 6c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1m10 10c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1Z"></path></svg></span></td>
</tr>
</table></p>
</details>
<p>A Kogito implementation of the <a href="https://github.com/sparkutils/dmn-4-spark">dmn-4-spark</a> API.</p>
<h2 id="supported-runtimes">Supported Runtimes<a class="headerlink" href="#supported-runtimes" title="Permanent link">¶</a></h2>
<p>Spark 3.5.x (Spark 4 hopefully coming soon) based runtimes on jdk 17 (OSS 2.13 builds are also provided).</p>
<p>Databricks requires the use of <a href="https://docs.databricks.com/aws/en/dev-tools/sdk-java#create-a-cluster-that-uses-jdk-17">JNAME</a>, with its associated reduction in support, in order to run on a non-jdk 8 VM for DBRs 14.0, 14.3 and 15.4.  16.4 moves to JDK 17 by default and also supports scala 2.13.</p>
<h2 id="how-to-use">How to Use<a class="headerlink" href="#how-to-use" title="Permanent link">¶</a></h2>
<p>Follow <a href="https://github.com/sparkutils/dmn-4-spark?tab=readme-ov-file#how-to-use">these instructions</a> found on the API page to depend on the correct version.</p>
<p>Then, assuming your DMN files are available on the classpath (e.g. test/resources) define your files as:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">dmnFiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span>
<span class="w">  </span><span class="nc">DMNFile</span><span class="p">(</span><span class="s">"common.dmn"</span><span class="p">,</span>
<span class="w">    </span><span class="bp">this</span><span class="p">.</span><span class="n">getClass</span><span class="p">.</span><span class="n">getClassLoader</span><span class="p">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="s">"common.dmn"</span><span class="p">).</span><span class="n">readAllBytes</span><span class="p">()</span>
<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="nc">DMNFile</span><span class="p">(</span><span class="s">"decisions.dmn"</span><span class="p">,</span>
<span class="w">    </span><span class="bp">this</span><span class="p">.</span><span class="n">getClass</span><span class="p">.</span><span class="n">getClassLoader</span><span class="p">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="s">"decisions.dmn"</span><span class="p">).</span><span class="n">readAllBytes</span><span class="p">()</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>or source them from byte arrays in a dataset using the api serialization.readVersionedFilesFromDF function.</p>
<p>Define the model you wish to run (the namespace and name must be present in one of the DMNFiles):</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">dmnModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DMNModelService</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="s">"DQService"</span><span class="p">),</span><span class="w"> </span><span class="s">"struct&lt;evaluate: array&lt;boolean&gt;&gt;"</span><span class="p">)</span>
</code></pre></div>
<p>when the DecisionService is provided, DQService the above example, only it will be executed, using None will trigger evaluateAll semantics.  The struct definition at the end defines your output structure, use JSON to serialize the DMNResult into JSON.  You can also use the serialization.readVersionedModelServicesFromDF to load models.</p>
<p>Define the DMNInputfields:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">inputFields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span>
<span class="w">  </span><span class="nc">DMNInputField</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span><span class="w"> </span><span class="s">"String"</span><span class="p">,</span><span class="w"> </span><span class="s">"testData.location"</span><span class="p">),</span>
<span class="w">  </span><span class="nc">DMNInputField</span><span class="p">(</span><span class="s">"idPrefix"</span><span class="p">,</span><span class="w"> </span><span class="s">"String"</span><span class="p">,</span><span class="w"> </span><span class="s">"testData.idPrefix"</span><span class="p">),</span>
<span class="w">  </span><span class="nc">DMNInputField</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="s">"Int"</span><span class="p">,</span><span class="w"> </span><span class="s">"testData.id"</span><span class="p">),</span>
<span class="w">  </span><span class="nc">DMNInputField</span><span class="p">(</span><span class="s">"page"</span><span class="p">,</span><span class="w"> </span><span class="s">"Long"</span><span class="p">,</span><span class="w"> </span><span class="s">"testData.page"</span><span class="p">),</span>
<span class="w">  </span><span class="nc">DMNInputField</span><span class="p">(</span><span class="s">"department"</span><span class="p">,</span><span class="w"> </span><span class="s">"String"</span><span class="p">,</span><span class="w"> </span><span class="s">"testData.department"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>this use the fields location, idPrefix, id, page and department to set entries in the "testData" DMNContext map.  Input fields can also be loaded via the serialization.readVersionedProvidersFromDF function.</p>
<p>Then combine the variables into the DMNExecution you wish to run with any additional configuration (currently ignored by kogito-4-spark):</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DMNExecution</span><span class="p">(</span><span class="n">dmnFiles</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">inputFields</span><span class="p">,</span><span class="w"> </span><span class="nc">DMNConfiguration</span><span class="p">.</span><span class="n">empty</span><span class="w"> </span><span class="cm">/* default value */</span><span class="p">)</span>
</code></pre></div>
<p>DMNExecutions too can be loaded from serialization.readVersionedExecutionsFromDF but requires you to provide all of the other input datasets (configuration can be optionally provided via serialization.readVersionedConfigurationDF).</p>
<p>finally register the DMN on your dataset (which contains the input fields):</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"dmn"</span><span class="p">,</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="n">sparkutils</span><span class="p">.</span><span class="n">dmn</span><span class="p">.</span><span class="nc">DMN</span><span class="p">.</span><span class="n">dmnEval</span><span class="p">(</span><span class="n">exec</span><span class="p">))</span>
</code></pre></div>
<p>you may use the optional <a href="#debug-mode">debug</a> parameter to capture additional information from kogito's DMNResult.</p>
<p><strong><em>NOTE:</em></strong> As with all Spark Datasets evaluation is lazy, write the dataset out to evaluate only once in-line per row as they are written.</p>
<h2 id="supported-dmncontextproviders">Supported DMNContextProviders<a class="headerlink" href="#supported-dmncontextproviders" title="Permanent link">¶</a></h2>
<p>The following JSON and DDL types are supported and provided to the org.kie.dmn.api.core.DMNContext</p>
<ul>
<li>JSON - string json representation</li>
<li>String</li>
<li>Integer</li>
<li>Long</li>
<li>Boolean</li>
<li>Double</li>
<li>Float</li>
<li>Binary - provided as a byte[]</li>
<li>Byte</li>
<li>Short</li>
<li>Date - provided as a LocalDate</li>
<li>Timestamp - provided as a LocalDateTime</li>
<li>Decimal - provided as DecimalType(DecimalType.MAX_PRECISION, DecimalType.DEFAULT_SCALE)</li>
<li>struct&lt;*&gt; - with any nested types, provided as util.Map[String, Object] with field names as the keys</li>
<li>array&lt;*&gt; - of any type, provided as util.List[Object]</li>
<li>map<string, *=""> - only supports util.Map[String, Object], the values may have any type</string,></li>
</ul>
<p>Non DDL Unary DMNContextProviders may be provided via a fully qualified class name and must provide a two arg constructor of DMNContextPath, Expression.</p>
<p>The data map used in the compilation of Context Providers can be configured via "useTreeMap=true" (default is false), this isn't terribly important for processing within Kogito but will affect JSON output ordering. (Interpreted mode is always ordered).</p>
<h2 id="supported-dmnresultproviders">Supported DMNResultProviders<a class="headerlink" href="#supported-dmnresultproviders" title="Permanent link">¶</a></h2>
<ul>
<li>JSON - Serializes the org.kie.dmn.api.core.DMNResult.getDecisionResults</li>
<li>Struct&lt;…&gt; DDL - with each field representing a decision name to result mapping</li>
</ul>
<p>Other DMNResultProviders may be provided via a fully qualified class name.</p>
<p>When Struct DDL is used each decisionName in the Kogito DMNResult will be stored against that struct, e.g. for a decision name "evaluate" which returns a list of booleans the DDL:</p>
<div class="highlight"><pre><span></span><code><span class="n">struct</span><span class="o">&lt;</span><span class="n">evaluate</span><span class="p">:</span><span class="w"> </span><span class="nb">array</span><span class="o">&lt;</span><span class="nb">boolean</span><span class="o">&gt;&gt;</span>
</code></pre></div>
<p>should be used.  Where the decisionName is not present in the results null is used, each element will therefore be set to nullable by the library.  Where a decision result is provided which is not the in the DDL it will be ignored (debug information may however be provided).</p>
<p>Use JSON to handle result schema evolution until a possible solution via Variants in Spark 4 is investigated.</p>
<h3 id="result-processing">Result Processing<a class="headerlink" href="#result-processing" title="Permanent link">¶</a></h3>
<p>In order to identify if a null result is due to an error or not a "_dmnEvalStatus: Byte" field can be added to the Struct DDL, e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="n">struct</span><span class="o">&lt;</span><span class="n">evaluate</span><span class="p">:</span><span class="w"> </span><span class="nb">array</span><span class="o">&lt;</span><span class="nb">boolean</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">evaluate_dmnEvalStatus</span><span class="p">:</span><span class="w"> </span><span class="n">Byte</span><span class="o">&gt;</span>
</code></pre></div>
<p>will store the Kogito DMNDecisionResult.getEvaluationStatus as a Byte with the following values:</p>
<table>
<thead>
<tr>
<th>DecisionEvaluationStatus (Severity)</th>
<th>_dmnEvalStatus Int stored</th>
</tr>
</thead>
<tbody>
<tr>
<td>NOT_FOUND (kogito-4-spark only<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>)</td>
<td>-6 (Typically a sign of a name mismatch)</td>
</tr>
<tr>
<td>NOT_EVALUATED</td>
<td>-5 (Should not happen)</td>
</tr>
<tr>
<td>EVALUATING</td>
<td>-4 (Should not happen)</td>
</tr>
<tr>
<td>SUCCEEDED</td>
<td>1</td>
</tr>
<tr>
<td>SKIPPED (WARN Msg.MISSING_EXPRESSION_FOR_DECISION)</td>
<td>-3</td>
</tr>
<tr>
<td>SKIPPED (ERROR)</td>
<td>-2</td>
</tr>
<tr>
<td>FAILED</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>These status' only replicate the Kogito <a href="https://github.com/kiegroup/drools/blob/7373d109e9020535f5f1c727852946405ea21912/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/impl/DMNRuntimeImpl.java#L669">DecisionEvaluationStatus usage</a> and do not represent any business logic from the underlying DMN, that must of course be encoded in the result DLL directly.</p>
<p>The top level decision result map is proxied for both DDL and JSON processing, should this lead to a performance deficit you may disable it via the config option "fullProxyDS=false".</p>
<h3 id="debug-mode">Debug mode<a class="headerlink" href="#debug-mode" title="Permanent link">¶</a></h3>
<p>Use debugMode when calling evaluate to force the full DMNResult structure (without results) to be written out into an additional debugMode field, in the case where no issues are present this is likely overkill and should be kept for debug information only.  The debugMode field has the following DDL type (also found in ResultProcessors.debugDDL):</p>
<div class="highlight"><pre><span></span><code><span class="n">debugMode</span><span class="p">:</span><span class="w"> </span><span class="nb">array</span><span class="o">&lt;</span><span class="w"> </span><span class="n">struct</span><span class="o">&lt;</span><span class="w"> </span>
<span class="w">  </span><span class="n">decisionId</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">  </span><span class="n">decisionName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">  </span><span class="n">hasErrors</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">,</span>
<span class="w">  </span><span class="n">messages</span><span class="p">:</span><span class="w"> </span><span class="nb">array</span><span class="o">&lt;</span><span class="w"> </span><span class="n">struct</span><span class="o">&lt;</span>
<span class="w">    </span><span class="n">sourceId</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">sourceReference</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">    </span><span class="k">exception</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">feelEvent</span><span class="p">:</span><span class="w"> </span><span class="n">struct</span><span class="o">&lt;</span>
<span class="w">      </span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">      </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">      </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span>
<span class="w">      </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span>
<span class="w">      </span><span class="n">sourceException</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="p">,</span>
<span class="w">      </span><span class="n">offendingSymbol</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="n">evaluationStatus</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span>
</code></pre></div>
<p>In this mode the output DDL more closely mimics the Kogito DMNResult, the two output types are not compatible.</p>
<p>The JSON provider when in debug mode serializes the entire DMNResult structure, when not the structure mimics the output of the Struct ddl counterpart e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">"eval"</span><span class="p">:{</span><span class="nt">"top1"</span><span class="p">:</span><span class="s2">"0a"</span><span class="p">,</span><span class="nt">"strings"</span><span class="p">:[</span><span class="s2">"a0i"</span><span class="p">,</span><span class="s2">"b0i"</span><span class="p">,</span><span class="s2">"c0i"</span><span class="p">,</span><span class="s2">"d0i"</span><span class="p">],</span><span class="nt">"structs"</span><span class="p">:[{</span><span class="nt">"a"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nt">"b"</span><span class="p">:</span><span class="mf">2061584302.16</span><span class="p">,</span><span class="nt">"d"</span><span class="p">:{</span><span class="nt">"a"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"b"</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span><span class="nt">"c"</span><span class="p">:{</span><span class="nt">"a1"</span><span class="p">:</span><span class="s2">"b1"</span><span class="p">}}]}}</span>
</code></pre></div>
<p>becomes:</p>
<div class="highlight"><pre><span></span><code><span class="p">[{</span><span class="nt">"decisionId"</span><span class="p">:</span><span class="s2">"_5BD6B443-5DB7-4CA4-84E2-AC86D643FB15"</span><span class="p">,</span><span class="nt">"decisionName"</span><span class="p">:</span><span class="s2">"eval"</span><span class="p">,</span><span class="nt">"result"</span><span class="p">:{</span><span class="nt">"top1"</span><span class="p">:</span><span class="s2">"0a"</span><span class="p">,</span><span class="nt">"strings"</span><span class="p">:[</span><span class="s2">"a0i"</span><span class="p">,</span><span class="s2">"b0i"</span><span class="p">,</span><span class="s2">"c0i"</span><span class="p">,</span><span class="s2">"d0i"</span><span class="p">],</span><span class="nt">"structs"</span><span class="p">:[{</span><span class="nt">"a"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="nt">"b"</span><span class="p">:</span><span class="mf">2061584302.16</span><span class="p">,</span><span class="nt">"d"</span><span class="p">:{</span><span class="nt">"a"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"b"</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span><span class="nt">"c"</span><span class="p">:{</span><span class="nt">"a1"</span><span class="p">:</span><span class="s2">"b1"</span><span class="p">}}]},</span><span class="nt">"messages"</span><span class="p">:[],</span><span class="nt">"evaluationStatus"</span><span class="p">:</span><span class="s2">"SUCCEEDED"</span><span class="p">}]</span>
</code></pre></div>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>The NOT_FOUND status is added by the library for the case where a _dmnEvalStatus field is provided in the ddl but this decision name that does not exist in the dmn. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">May 8, 2025 21:18:51</span>
<br/>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">May 8, 2025 21:18:51</span>
</small>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.top", "navigation.expand", "content.code.copy"], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
<script src="assets/javascripts/bundle.fc8c2696.min.js"></script>
<script src="js/jquery-3.6.3.min.js"></script>
<script src="js/tagflipper.js"></script>
</body>
</html>